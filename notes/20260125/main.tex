\documentclass[a4paper,11pt,dvipdfmx]{jsarticle}
\usepackage{amsmath, amssymb, amsthm}
\usepackage{bm}
\usepackage{mathtools}
\usepackage{comment}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{bm}
\usepackage{mathtools}
\usepackage{enumitem}
\mathtoolsset{showonlyrefs}
\usepackage[dvipdfmx, colorlinks=true, linkcolor=blue, citecolor=blue, urlcolor=blue, setpagesize=false]{hyperref}
\usepackage{pxjahyper}
% --- 定理・定義環境 ---
\theoremstyle{definition}
\newtheorem{definition}{定義}[section]
\newtheorem{theorem}[definition]{定理}
\newtheorem{lemma}[definition]{補題}
\newtheorem{assumption}{仮定}
\newtheorem{proposition}[definition]{命題}
\newtheorem{requirement}[definition]{要請}
\newtheorem{example}[definition]{例}
\input{../command.tex}
% =========================================
\begin{document}

\title{}
\author{}
\date{\today}
\maketitle
\tableofcontents
\clearpage

\section{ブロックサイクルが閉かどうかの判定}\label{ssec:is_cbc}
サイクルの関数が$f(x)=ax+b$であるとする。
このとき、サイクルが閉であることはある$x\in[P]$について$ax+b = x$が成り立つことである。
よって、$(a-1)x+b=0$を満たす$x$が存在するならブロックサイクルは閉である。
この条件は、
\begin{align}
  b \equiv 0 \pmod{\gcd(a-1, P)}\label{eq:cbc}
\end{align}
と書き換えられる。つまり、$a=1$のとき、$b=0$ならばすべての$x$が解である。
$a\neq 1$のとき、$b$が$\gcd(a-1, P)$で割り切れる時のみ解が存在、すなわちサイクルは閉である。

\section{笠井先生の論文について}
\cite{kasai2026breakingorthogonalitybarrierquantum}
\subsection{従来の行列の構成方法}
\begin{definition}\label{def:01231}
  $\HHX,\HHZ$を母行列、$\HX,\HZ$をアクティブ行列、$\tHX,\tHZ$を潜在部と呼ぶ。
  以下が成り立つ。
  \begin{align}\label{eq:012313}
  \HHX = \begin{bmatrix}
  \HX\\
  \tHX
  \end{bmatrix},\qquad
  \HHZ = \begin{bmatrix}
  \HZ\\
  \tHZ
  \end{bmatrix}
  \end{align}
\end{definition}
$\HHX,\HHZ$は2つの直交する正方(ブロック巡回)母行列である。
これらにより構成される母行列のレートは0である。
よってレートを調整するのに内部行を消去する。

ここで、母行列の直交性は潜在部の行に強い制約を課し、最小距離を劣化させる。
\begin{definition}\label{def:01233}
最小距離を以下で定義する。
\begin{align}\label{eq:01234}
  \dz := \min\{\wt(z):z\in C_X\backslash C_Z^\top\},\qquad
  \dx := \min\{\wt(x):x\in C_Z\backslash C_X^\top\}
\end{align}  
\end{definition}
\begin{theorem}\label{th:01235}
  母行列の直交性$\HHX(\HHZ)^\top=0$は、アクティブ部の直交性$\HX(\HZ)^\top=0$だけでなく、
  \begin{align}\label{eq:01236}
    \HX(\tHZ)^\top=0,\qquad
    \tHX(\HZ)^\top=0
  \end{align}
  も強要する。  
\end{theorem}
これは、$\Row(\HHX)\subset C_Z$および$\Row(\HHZ)\subset C_X$であることを暗示している。
したがって、$\tHX$の各行$\bm{x}$について$\bm{x}\in C_Z$、$\tHZ$の各行$\bm{z}$について$\bm{z}\in C_X$が成り立つ。
一般的には$\bm{x}$は$C_X^\top$に属する必要はなく、$\bm{z}$も$C_Z^\perp$に属する必要はなく、このときこれらは論理演算子となる。最小行重み(我々の構成では$L$)が$d_X$および$d_Z$の上界となる。

\subsection{新しい行列の構成方法}
母行列から行を削除することでアクティブ行列$\HX,\HZ$を得るが、潜在行列の低重み行が、$\HX,\HZ$と直交しないようにこれらを設計する。
つまり、低重みの$\bm{x}\in\Row(\tHX)$に対し$\HZ\bm{x}^\top \neq 0$を、$\bm{z}\in\Row(\tHZ)$に対し$\HX\bm{z}^\top \neq 0$を強制し、つまり$\Row(\tHX)\not\subset C_Z$および$\Row(\tHZ)\not\subset C_X$を強制する。
同じ議論は、個々の潜在行だけでなく、低重みの線形結合にも適用される。

\begin{definition}\label{def:01237}
  潜在ベースの$X,Z$距離の上界を以下で定義する。
  \begin{align}
  d_X^{\text{(lat)}} &:= \min\left\{\wt(\bm{x}):\bm{x}\in \Row(\tHX)\cap C_Z\backslash C_X^\perp\right\}\\
  &=\min\left\{\wt(\bm{x}):\bm{x}\in C_Z, \bm{x}=(\tHX)^\top\bm{u}\text{ for some }\bm{u}, \bm{x}\not\in C_X^\top\right\}\\
  d_Z^{\text{(lat)}} &:= \min\left\{\wt(\bm{z}):\bm{z}\in \Row(\tHZ)\cap C_X\backslash C_Z^\perp\right\} \\
  &=\min\left\{\wt(\bm{z}):\bm{z}\in C_X, \bm{z}=(\tHZ)^\top\bm{u}\text{ for some }\bm{u}, \bm{z}\not\in C_Z^\top\right\}\\
\end{align}
\end{definition}

まとめると、
\begin{align}
\HX\HZ^\top = 0,\quad\HX(\tHZ)^\top \neq 0, \quad\HZ(\tHX)^\top \neq 0 
\end{align}
かつ$\dxl,\dzl$が大きい、を満たすような潜在行列$\tHX,\tHZ$を構成したい。
一般化した萩原・今井符号、つまりブロック巡回構造の母行列のペアを定義し、アクティブ部の直交性$\HX(\HZ)^\top = 0$のみを課す。
行重み$J$、列重み$L$のプロトグラフLDPC符号はサイズ$P$の$J\times L$の置換行列により定義される。

\begin{definition}\label{def:01238}
  サイズ$LP/2\times LP$の母行列を以下で定義する。
  \begin{align}
    (\HHX)_{i,j} &= F_{j-i},\quad (\HHX)_{i,L_2+j}=G_{j-i},\\
    (\HHZ)_{i,j} &= G_{i-j}^\top,\quad (\HHZ)_{i,L_2+j}=F_{i-j}^\top,
  \end{align}
\end{definition}
アクティブ行列は母行列の上$J$ブロック行を取ることで得られる。

潜在部がアクティブ部と可換でないようにすることで、低重みの潜在部の組は自動的に論理演算子にならない。

ブロック巡回構造は$\HX(\HZ)^\top$が差分のみに依存するようにし、結果である
Interaction Matrix$\Psi_r$により、可換性制約を小さな差分集合に位置づけられる。


$\HHX$の各ブロック行は、左側は$(F_0,F_1,\dots,F_{L/2-1})$の巡回シフトであり、右側は$(G_0,G_1,\dots,G_{L/2-1})$の巡回シフトである。
したがってブロックは差分$(j-i)$のみに依存し、母行列の積も差分のみに依存する。
任意の$i,k\in[L/2]$に対して、$(i,k)$ブロックは
\begin{align}
  (\HHX(\HHZ)^\top)_{i,k} = \sum_{u=0}^{L_2-1}\left(F_uG_{k-u} + G_{k-u}F_u\right) =: \Psi_r
\end{align}
で与えられ、これは$r=(k-i)\mod L_2$のみに依存する。
$r\in[L/2]$に対し、すべての$u\in[L/2]$に対し$F_u$と$G_{r-u}$が可換ならば、$\Psi_r=0$である。

\subsection{アクティブ部の直交性の十分条件}
\begin{definition}\label{def:01239}
  \begin{align}
    \Delta := \left\{(k-i)\mod L/2\mid 0\leq i,k\leq J-1\right\}\subseteq[L/2]
  \end{align}
\end{definition}
\begin{theorem}\label{th:012310}
  もし$F_u$と$G_{r-u}$がすべての$r\in\Delta,u\in[L/2]$に対し可換ならば、$\HX\HZ^\top=0$である。
\end{theorem}

\subsection{潜在部の非直交性の必要条件}
\begin{definition}\label{def:012311}
  可換性が必要な$(F_i,G_j)$のインデックスペアを以下で定義する。
  \begin{align}
    \Gamma := \bigcup_{r\in\Delta} \Gamma_r,\quad \Gamma_r := \{(i,j)\mid(i,j)=(u,r-u), u\in[L/2]\}
  \end{align}
\end{definition}
$L\geq 4J$および$\Psi_r\neq 0$を満たすような$r\in[L/2]\backslash \Delta$が存在することが、
潜在部の非直交性の必要条件である。

\subsection{ガーズの上界}
長さ8のサイクルは必ず存在する。
\begin{align}
    W=F_{i}G_j\inv G_{j'}F_i\inv F_{i'}G_{j'}\inv G_jF_{i'}\inv\label{eq:01232}
\end{align}
はUTCBCである。
他にもUTCBCの形があるかもしれない。

\subsection{行列構築の方法}
与えられた$(L/2,P,J)$に対して、以下を同時に満たす$\{F_i\},\{G_i\}$を構築する。
\begin{enumerate}[label=\Alph*', ref=\Alph*']
  \item $f_i,G_j$は$(i,j)\in\Delta$に対して可換である\label{condition:a'}
  \item 少なくとも一つの$(i,j)\in[L/2]^2\backslash\Delta$に対して非可換である\label{condition:b'}
  \item アクティブ行列$\HX,\HZ$内の短いサイクルを避ける(長さ8以下のUTCBC以外のサイクル)\label{condition:c'}
\end{enumerate}
可換表テーブル：
\begin{table}[htbp]
\centering
\begin{tabular}{c|cccccc}
      & $G_0$ & $G_1$ & $G_2$ & $G_3$ & $G_4$ & $G_5$ \\ \hline
$F_0$ & 1     & 1     & 1     & 0     & 1     & 1     \\
$F_1$ & 1     & 1     & 0     & 1     & 1     & 1     \\
$F_2$ & 1     & 1     & 1     & 1     & 1     & 1     \\
$F_3$ & 1     & 1     & 1     & 1     & 1     & 1     \\
$F_4$ & 1     & 1     & 1     & 1     & 1     & 1     \\
$F_5$ & 1     & 1     & 1     & 1     & 1     & 1     \\
\end{tabular}
\end{table}

\section{この論文での条件を満たす\texorpdfstring{$F_i,G_i$}{Fi, Gi}の構成}
目標は、$f_0$と$g_3$、$f_1$と$g_2$が非可換であり、他がすべて可換であるような$F_i,G_i$を見つけることである。(他が厳密に可換である必要があるのかはわからないが、今は条件から解空間を特定することに集中する。)

これまでと同様、$f_i(x) = a_{f_i}x+b_{f_i}$のようにあらわす。
\subsection{条件\ref{condition:a'}}
\begin{align}
  (a_{f_i} - 1)b_{g_j} - (a_{g_j} - 1)b_{f_i} \equiv 0 \pmod P\quad\text{ for }(i,j)\in[L/2]^2\backslash\{(0,3),(1,2)\}\label{eq:01231}
\end{align}

\subsection{条件\ref{condition:b'}}
\begin{align}
  (a_{f_i} - 1)b_{g_j} - (a_{g_j} - 1)b_{f_i} \not\equiv 0 \pmod P\quad\text{ for }(i,j)=(0,3),(1,2)\label{eq:012312}
\end{align}


\subsection{条件\ref{condition:c'}}
条件\ref{condition:c'}を考える前に、今回の$\HHX,\HHZ$におけるUTCBCを特定する。
$\HHX,\HHZ$は以下である。
\begin{align}
  \HHX &= \left( \begin{array}{cccccc|cccccc}
  F_0 & F_1 & F_2 & F_3 & F_4 & F_5 & G_0 & G_1 & G_2 & G_3 & G_4 & G_5 \\
  F_5 & F_0 & F_1 & F_2 & F_3 & F_4 & G_5 & G_0 & G_1 & G_2 & G_3 & G_4 \\
  F_4 & F_5 & F_0 & F_1 & F_2 & F_3 & G_4 & G_5 & G_0 & G_1 & G_2 & G_3 \\ \hline
  F_3 & F_4 & F_5 & F_0 & F_1 & F_2 & G_3 & G_4 & G_5 & G_0 & G_1 & G_2 \\
  F_2 & F_3 & F_4 & F_5 & F_0 & F_1 & G_2 & G_3 & G_4 & G_5 & G_0 & G_1 \\
  F_1 & F_2 & F_3 & F_4 & F_5 & F_0 & G_1 & G_2 & G_3 & G_4 & G_5 & G_0
  \end{array} \right).\\
  \HHZ &= \left( \begin{array}{cccccc|cccccc}
  G'_0 & G'_5 & G'_4 & G'_3 & G'_2 & G'_1 & F'_0 & F'_5 & F'_4 & F'_3 & F'_2 & F'_1 \\
  G'_1 & G'_0 & G'_5 & G'_4 & G'_3 & G'_2 & F'_1 & F'_0 & F'_5 & F'_4 & F'_3 & F'_2 \\
  G'_2 & G'_1 & G'_0 & G'_5 & G'_4 & G'_3 & F'_2 & F'_1 & F'_0 & F'_5 & F'_4 & F'_3 \\ \hline
  G'_3 & G'_2 & G'_1 & G'_0 & G'_5 & G'_4 & F'_3 & F'_2 & F'_1 & F'_0 & F'_5 & F'_4 \\
  G'_4 & G'_3 & G'_2 & G'_1 & G'_0 & G'_5 & F'_4 & F'_3 & F'_2 & F'_1 & F'_0 & F'_5 \\
  G'_5 & G'_4 & G'_3 & G'_2 & G'_1 & G'_0 & F'_5 & F'_4 & F'_3 & F'_2 & F'_1 & F'_0
  \end{array} \right).
\end{align}

\subsubsection{サイクルの定義について}
\cite{kasai2025quantum}によると、
"In this construction, each step in the path moves either to a different row or to a different column, but not both simultaneously. That is, consecutive blocks must differ in exactly one of their row or column indices"
とあり、サイクルの隣り合う要素は行か列いずれか1つが異ならなければならない。よって、行インデックスシーケンス、列インデックスシーケンスともに同じ要素が連続してはいけない、という前提とする。(要確認)

サイクルは最初の位置から、1つおきに位置を指定することで、サイクルを一意に特定できる。
% 例えば、長さ8のサイクルについて、4つの位置($[r_1, c_1],[r_2, c_2],[r_3, c_3],[r_4, c_4]$)を指定すれば、サイクルは
% \[
% [r_1, c_1]\rightarrow[r_1,c_2]\rightarrow[r_2,c_2]\rightarrow[r_2,c_3]\rightarrow[r_3,c_3]\rightarrow[r_3,c_4]\rightarrow[r_4,c_4]\rightarrow[r_4,c_1]\rightarrow[r_1,c_1]
% \]
% と一意に特定される。

\subsubsection{検査すべきサイクルの個数}
\paragraph{長さ4のサイクル}
長さ4のサイクルは、2つの位置を与えれば、構成する4つの位置が決まる。
よって、同値な条件を導く位置選択は4つずつ存在する。
例えば、2つの位置を$[r_1, c_1],[r_2, c_2]$とすると、サイクルは
\begin{align}
  [r_1, c_1]\rightarrow[r_1,c_2]\rightarrow[r_2,c_2]\rightarrow[r_2,c_1]\rightarrow[r_1,c_1]\label{cy:012801}
\end{align}
である。
この時、位置$[r_1, c_2],[r_2, c_1]$により指定されるサイクルは、
\begin{align}
  [r_1,c_2]\rightarrow[r_1,c_1]\rightarrow[r_2,c_1]\rightarrow[r_2,c_2]\rightarrow[r_1,c_2]\label{cy:012802}
\end{align}
である。
サイクル\ref{cy:012801}とサイクル\ref{cy:012802}が導く条件は同値である。

以上を踏まえ、検査すべきサイクルの個数を考える。
まず、2つの位置の選び方は、列、行ともに異なるものを選ぶ必要があることを考えると、1つ目が$L/2\times L$通り、2つ目は$(L/2-1)\times (L-1)$通りであり、全部で$L/2\times (L/2-1)\times L\times (L-1)$通りである。
よって、検査すべきサイクルの個数は
\begin{align}
  L/2\times (L/2-1)\times L\times (L-1)/4\label{eq:012803}
\end{align}
個である。
$L=12$を代入すると、
\begin{align}
  6\times 5\times 12\times 11 /4 = 990
\end{align}
個である。

\paragraph{長さ6のサイクル}
長さ6のサイクルは、3つの位置を与えれば、サイクルが一意に決まる。
例えば、3つの位置を$[r_1, c_1],[r_2, c_2], [r_3, c_3]$とすると、サイクルは
\begin{align}
  [r_1, c_1]\rightarrow[r_1,c_2]\rightarrow[r_2,c_2]\rightarrow[r_2,c_3]\rightarrow[r_3,c_3]\rightarrow[r_3,c_1]\rightarrow[r_1,c_1]\label{cy:012804}
\end{align}
である。

以上を踏まえ、検査すべきサイクルの個数を考える。
まず、3つの位置の選び方は、行インデックス$\{r_1,r_2,r_3\}$と列インデックス$\{c_1,c_2,c_3\}$がそれぞれ相異なる必要があるので、
\begin{align}
  (L/2)\times (L/2-1)\times (L/2-2)\times L\times (L-1)\times (L-2)
\end{align}
通りである。
また、同一のサイクルを与える3つの位置の並べ方は、サイクルの開始点の選び方(3通り)と巡回方向(2通り)により$6$通りある。
したがって、検査すべきサイクルの個数は
\begin{align}
  \frac{(L/2)\times (L/2-1)\times (L/2-2)\times L\times (L-1)\times (L-2)}{6}\label{eq:012805}
\end{align}
個である。
$L=12$を代入すると、
\begin{align}
  \frac{6\times 5\times 4\times 12\times 11\times 10}{6} = 26400
\end{align}
個である。

\paragraph{長さ8のサイクル}
長さ8のサイクルは、4つの位置$[r_1,c_1],[r_2,c_2],[r_3,c_3],[r_4,c_4]$を与えれば一意に定まる。
ここで「円勘定に考えて、隣り合うものは等しくてはいけない」という条件を課す。
すなわち、行インデックスは
\[
  r_1\neq r_2,\ r_2\neq r_3,\ r_3\neq r_4,\ r_4\neq r_1
\]
を満たし、列インデックスも
\[
  c_1\neq c_2,\ c_2\neq c_3,\ c_3\neq c_4,\ c_4\neq c_1
\]
を満たす（ただし、$r_1=r_3$や$c_1=c_3$のような非隣接の一致は許す）。

まず、行インデックスの並び$(r_1,r_2,r_3,r_4)$の選び方は
\begin{align}
  (L/2)\times (L/2-1)\times \left((L/2)^2-3(L/2)+3\right)
\end{align}
通りである。  

ここで、$n:=L/2$とおくと、$r_1$は$n$通り、$r_2$は$r_2\neq r_1$より$n-1$通りである。
さらに$(r_3,r_4)$は、$r_3\neq r_2$かつ$r_4\neq r_3,r_1$を満たす必要がある。
$r_3=r_1$の場合は$r_4\neq r_1$のみなので$n-1$通り、$r_3\neq r_1$の場合は$r_3$が$n-2$通りで各々$r_4$が$n-2$通りである。
よって$(r_3,r_4)$の選び方は
\[
  (n-1)+(n-2)^2 = n^2-3n+3
\]
通りとなり、これが$\left((L/2)^2-3(L/2)+3\right)$に対応する。
同様に、列インデックスの並び$(c_1,c_2,c_3,c_4)$の選び方は
\begin{align}
  L\times (L-1)\times \left(L^2-3L+3\right)
\end{align}
通りである。
したがって、4つの位置の選び方はそれらの積で与えられる。

また、同一のサイクルを与える4つの位置の並べ方は、サイクルの開始点の選び方(4通り)と巡回方向(2通り)により最大で$8$通りある。
ただし、この「$8$通り」が常に相異なるとは限らない点に注意する。
実際、位置列$([r_1,c_1],[r_2,c_2],[r_3,c_3],[r_4,c_4])$に周期がある（巡回シフトで自分自身に戻る）場合、同一サイクルを与える表現の個数は$8$より小さくなる。

ここでは、同一視する操作を
\begin{itemize}
  \item 巡回シフト（開始点の変更）
  \item 反転（巡回方向の反転）
\end{itemize}
とし、長さ8サイクルの「表現の重複数」を場合分けする。

\paragraph{ケース1：周期なし（最小周期4、すなわち長さ8の真の巡回）}
巡回シフト$4$通りがすべて相異なり、さらに反転で$\times 2$されるので、重複数は$8$である（通常ケース）。

\paragraph{ケース2：周期2（2ステップで同じ位置列に戻る）}
巡回シフトは$4$通りのうち$2$通りしか相異ならず、反転まで含めた重複数は最大でも$4$となる。

よって、周期2の個数$N_{\mathrm{per2}}$を別途評価して補正する必要がある。
ここで$N_{\mathrm{all}}$は（隣接不一致のみ課した）4位置列の総数である。

今回の設定（隣接不一致のみ）では、周期2とは
\[(r_1,c_1)=(r_3,c_3),\ (r_2,c_2)=(r_4,c_4)\]
が成り立つことと同値であり、よって
\begin{align}
  N_{\mathrm{per2}} &= (L/2)\,(L/2-1)\cdot L\,(L-1)
\end{align}
となる。
また、前段で求めた4位置列の総数は
\begin{align}
  N_{\mathrm{all}} &= (L/2)\,(L/2-1)\,\left((L/2)^2-3(L/2)+3\right)\cdot L\,(L-1)\,\left(L^2-3L+3\right).
\end{align}

したがって$L=12$では
\begin{align}
  N_{\mathrm{per2}} &= 6\times 5\times 12\times 11 = 3960,\\
  N_{\mathrm{all}} &= 6\times 5\times 21\times 12\times 11\times 111 = 9230760,\\
  N_8 &= \frac{9230760-3960}{8}+\frac{3960}{4}=1154340.
\end{align}

以上合わせると、検査すべきサイクルは
$990+26400+1154340 = 1181730$個である。

\section{行列を用いた条件\ref{condition:a'},\ref{condition:b'}の定式化}\label{sec:14}
条件\ref{condition:a'}および\ref{condition:b'}を行列を用いて表現する。
\begin{align}
  \aU = [a_{f_0},a_{f_1},\dots,a_{f_5},a_{g_0},a_{g_1},\dots,a_{g_5}]\tr,\qquad
  \bU = [b_{f_0},b_{f_1},\dots,b_{f_5},b_{g_0},b_{g_1},\dots,b_{g_5}]\tr
\end{align}
とする。
$\aU$を定数として固定することで条件を満たす$\bU$の解空間を求める。

行列$G'$を以下の$L,R$を用いて$G' = [L\mid R]$と定義する。
\begin{align}
  L_{(6i+j, k)} &= \begin{cases}
    1-a_{g_i} & \mif k = i\\
    0 & \text{otherwise}
  \end{cases}\\
  R_{(6i+j, k)} &= \begin{cases}
    a_{f_j}-1 & \mif k = j\\
    0 & \text{otherwise}
  \end{cases}
\end{align}

\paragraph{条件\ref{condition:a'}}
$G'$から3,8行目($(i,j)=(0,3),(1,2)$に対応する行)を除いたものを$G_a'$とすると、条件\ref{condition:a'}は以下で表される。
\begin{align}
  G_a'\bU \equiv O \pmod P
\end{align}

\paragraph{条件\ref{condition:b'}}
$G'$の3,8行目のみを取り出したものを$G_b'$とすると、条件\ref{condition:b'}は、
\begin{align}
  G_b'\bU \not\equiv \cU_b' \pmod P
\end{align}
かつ$\cU_b'$の要素がすべて非ゼロであることである。
\section{条件\ref{condition:c'}の定式化}

\paragraph{条件\ref{condition:c'}}
条件\ref{condition:c'}は、1181730個ものサイクルについて考える必要があるので、代表として合成関数が$f_C(x) = a_C x + b_C$であるサイクルを考える。
条件は、
\begin{align}
  b_C \not\equiv 0 \pmod{\gcd(a_C-1, P)}\label{eq:012601}
\end{align}
が成り立つことで、$b_C$は$\bU$の線形結合として$b_C = c_C \bU$で表せる。
これを用いると、\eqref{eq:012601}は以下のように表せる。
\begin{align}
  c_C\bU \not\equiv 0 \pmod{\gcd(a_C-1, P)}\label{eq:012602}\\
  \iff \frac{P}{\gcd(a_C-1, P)}c_C\bU \not\equiv 0 \pmod{P}\label{eq:012603}
\end{align}
これをすべてのサイクルについて連結することで行列$G_c'$を得ることで、条件\ref{condition:c'}は
\begin{align}
  G_c'\bU \not\equiv \cU_c' \pmod P
\end{align}
かつ$\cU_c'$の要素がすべて非ゼロであることである。
% a_{f_}x+b_{f_}
% a_{f_}\inv(x-b_{f_})
\subsection{サイクルの合成関数の導出}
まず、関数$f(x)=ax+b$の逆関数は、$f\inv(x)=a\inv(x - b)$である。
まず、$\HHX$上での条件$\ref{condition:c'}$のための制約式を導く。

\subsubsection{$\HHX$での制約条件}

\paragraph{長さ4のサイクル}
長さ4のサイクルが、関数$h_0, h_1, h_2, h_3$から構成されるとすると、このサイクルの合成関数の逆関数$f_C\inv$は、
\begin{align}
  f_C\inv(x) &= h_0\inv h_1 h_2\inv h_3(x)\\
  &=a_{h_0}\inv((a_{h_1}(a_{h_2}\inv((a_{h_3}x+b_{h_3})-b_{h_2}))+b_{h_1})-b_{h_0})\\
  &= a_{h_0}\inv a_{h_1}a_{h_2}\inv a_{h_3}x + a_{h_0}\inv a_{h_1}a_{h_2}\inv(b_{h_3}-b_{h_2}) + a_{h_0}\inv(b_{h_1}-b_{h_0})
\end{align}
よって、
\begin{align}
  a_C &= a_{h_0}\inv a_{h_1}a_{h_2}\inv a_{h_3}\\
  b_C &= a_{h_0}\inv a_{h_1}a_{h_2}\inv(b_{h_3}-b_{h_2}) + a_{h_0}\inv(b_{h_1}-b_{h_0})
\end{align}

\paragraph{長さ6のサイクル}
長さ6のサイクルが、関数$h_0, h_1, h_2, h_3, h_4, h_5$から構成されるとすると、このサイクルの合成関数の逆関数$f_C\inv$は、
\begin{align}
  f_C\inv(x) &= h_0\inv h_1 h_2\inv h_3 h_4\inv h_5(x)\\
  &= a_{h_0}\inv a_{h_1}a_{h_2}\inv a_{h_3}a_{h_4}\inv a_{h_5}x \\
  &\quad + a_{h_0}\inv a_{h_1}a_{h_2}\inv a_{h_3}a_{h_4}\inv(b_{h_5}-b_{h_4}) + a_{h_0}\inv a_{h_1}a_{h_2}\inv(b_{h_3}-b_{h_2}) + a_{h_0}\inv(b_{h_1}-b_{h_0})
\end{align}
よって、
\begin{align}
  a_C &= a_{h_0}\inv a_{h_1}a_{h_2}\inv a_{h_3}a_{h_4}\inv a_{h_5}\\
  b_C &= a_{h_0}\inv a_{h_1}a_{h_2}\inv a_{h_3}a_{h_4}\inv(b_{h_5}-b_{h_4}) + a_{h_0}\inv a_{h_1}a_{h_2}\inv(b_{h_3}-b_{h_2}) + a_{h_0}\inv(b_{h_1}-b_{h_0})
\end{align}

\paragraph{長さ8のサイクル}
長さ8のサイクルが、関数$h_0, h_1, h_2, h_3, h_4, h_5, h_6, h_7$から構成されるとすると、このサイクルの合成関数の逆関数$f_C\inv$は、
\begin{align}
  f_C\inv(x) &= h_0\inv h_1 h_2\inv h_3 h_4\inv h_5 h_6\inv h_7(x)\\
  &= a_{h_0}\inv a_{h_1}a_{h_2}\inv a_{h_3}a_{h_4}\inv a_{h_5}a_{h_6}a_{h_7}\inv x + a_{h_0}\inv a_{h_1}a_{h_2}\inv a_{h_3}a_{h_4}\inv a_{h_5}a_{h_6}\inv(b_{h_7}-b_{h_6})\\
  &\quad + a_{h_0}\inv a_{h_1}a_{h_2}\inv a_{h_3}a_{h_4}\inv(b_{h_5}-b_{h_4}) + a_{h_0}\inv a_{h_1}a_{h_2}\inv(b_{h_3}-b_{h_2}) + a_{h_0}\inv(b_{h_1}-b_{h_0})
\end{align}
よって、
\begin{align}
  a_C &= a_{h_0}\inv a_{h_1}a_{h_2}\inv a_{h_3}a_{h_4}\inv a_{h_5}a_{h_6}a_{h_7}\inv\\
  b_C &= a_{h_0}\inv a_{h_1}a_{h_2}\inv a_{h_3}a_{h_4}\inv a_{h_5}a_{h_6}\inv(b_{h_7}-b_{h_6})\\
  &\quad + a_{h_0}\inv a_{h_1}a_{h_2}\inv a_{h_3}a_{h_4}\inv(b_{h_5}-b_{h_4}) + a_{h_0}\inv a_{h_1}a_{h_2}\inv(b_{h_3}-b_{h_2}) + a_{h_0}\inv(b_{h_1}-b_{h_0})
\end{align}

\subsubsection{$\HHZ$での制約条件}
一方で$\HHZ$での条件を考えるには、工夫が必要である。
$\HHZ$を構成する関数はすべて$f,g$の逆関数である。よって、これまでの説明で用いた$h_i$に対応する関数が$f_i\inv, g_i\inv$になってしまい、扱いづらい。
そこで、改めて、$h\inv$を用いた表現でサイクルの合成関数を考え直す。

\paragraph{長さ4のサイクル}
長さ4のサイクルが、関数$h_0\inv, h_1\inv, h_2\inv, h_3\inv$から構成されるとすると、このサイクルの合成関数の逆関数$f_C\inv$は、
\begin{align}
  f_C\inv(x) &= h_0 h_1\inv h_2 h_3\inv(x)\\
  &=a_{h_0}(a_{h_1}\inv((a_{h_2}(a_{h_3}\inv(x - b_{h_3})) + b_{h_2})-b_{h_1})) + b_{h_0}\\
  &= a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv x + b_{h_0} - a_{h_0}a_{h_1}\inv b_{h_1} + a_{h_0}a_{h_1}\inv b_{h_2} - a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv b_{h_3} 
\end{align}
よって、
\begin{align}
  a_C &= a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv\\
  b_C &= b_{h_0} - a_{h_0}a_{h_1}\inv b_{h_1} + a_{h_0}a_{h_1}\inv b_{h_2} - a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv b_{h_3}
\end{align}

\paragraph{長さ6のサイクル}
長さ6のサイクルが、関数$h_0\inv, h_1\inv, h_2\inv, h_3\inv, h_4\inv, h_5\inv$から構成されるとすると、このサイクルの合成関数の逆関数$f_C\inv$は、
\begin{align}
  f_C\inv(x) &= h_0 h_1\inv h_2 h_3\inv h_4 h_5\inv(x)\\
  &= a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv a_{h_4} a_{h_5}\inv x + b_{h_0} - a_{h_0}a_{h_1}\inv b_{h_1} + a_{h_0}a_{h_1}\inv b_{h_2}\\
  &\quad - a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv b_{h_3} + a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv b_{h_4}\\
  &\quad - a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv a_{h_4}a_{h_5}\inv b_{h_5}
\end{align}
よって、
\begin{align}
  a_C &= a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv a_{h_4} a_{h_5}\inv\\
  b_C &= b_{h_0} - a_{h_0}a_{h_1}\inv b_{h_1} + a_{h_0}a_{h_1}\inv b_{h_2}\\
  &\quad - a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv b_{h_3} + a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv b_{h_4}\\
  &\quad - a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv a_{h_4}a_{h_5}\inv b_{h_5}
\end{align}

\paragraph{長さ8のサイクル}
長さ6のサイクルが、関数$h_0\inv, h_1\inv, h_2\inv, h_3\inv, h_4\inv, h_5\inv. h_6\inv, h_7\inv$から構成されるとすると、このサイクルの合成関数の逆関数$f_C\inv$は、
\begin{align}
  f_C\inv(x) &= h_0 h_1\inv h_2 h_3\inv h_4 h_5\inv h_6 h_7\inv(x)\\
  &= a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv a_{h_4} a_{h_5}\inv a_{h_6} a_{h_7}\inv x + b_{h_0} - a_{h_0}a_{h_1}\inv b_{h_1} + a_{h_0}a_{h_1}\inv b_{h_2}\\
  &\quad - a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv b_{h_3} + a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv b_{h_4}\\
  &\quad - a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv a_{h_4}a_{h_5}\inv b_{h_5} + a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv a_{h_4}a_{h_5}\inv b_{h_6}\\
  &\quad - a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv a_{h_4}a_{h_5}\inv a_{h_6}a_{h_7}\inv b_{h_7}
\end{align}
よって、
\begin{align}
  a_C &= a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv a_{h_4} a_{h_5}\inv a_{h_6} a_{h_7}\inv\\
  b_C &= b_{h_0} - a_{h_0}a_{h_1}\inv b_{h_1} + a_{h_0}a_{h_1}\inv b_{h_2}\\
  &\quad - a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv b_{h_3} + a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv b_{h_4}\\
  &\quad - a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv a_{h_4}a_{h_5}\inv b_{h_5} + a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv a_{h_4}a_{h_5}\inv b_{h_6}\\
  &\quad - a_{h_0}a_{h_1}\inv a_{h_2}a_{h_3}\inv a_{h_4}a_{h_5}\inv a_{h_6}a_{h_7}\inv b_{h_7}
\end{align}

\subsection{UTCBCの定式化}
長さ8のUTCBCは、以下の手順で導く
\begin{enumerate}
  \item 開始位置$[r_0,c_0]$を決める。
  \item 次の位置$[r_0,c_1]$を決める。
  \item 次の位置$[r_1,c_1]$を決める。
  \item 次の位置の関数が$[r_0,c_0]$のものと等しくなるような$c_2$がただ一つに定まる。
  \item 次の位置$[r_2,c_2]$を決める。
  \item 次の位置の関数が$[r_1,c_1]$のものと等しくなるような$c_3$がただ一つに定まる。
  \item 次の位置の関数が$[r_0,c_1]$のものと等しくなるような$r_3$がただ一つに定まる。
  \item $[r_3,c_0]$の関数は$[r_2,c_2]$のものと等しい。
\end{enumerate}

\bibliography{refs}
\bibliographystyle{unsrt} %参考文献出力スタイル
\end{document}