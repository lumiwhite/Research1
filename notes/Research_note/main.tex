\documentclass[a4paper,11pt,dvipdfmx]{jsarticle}
\usepackage{amsmath, amssymb, amsthm}
\usepackage{bm}
\usepackage{mathtools}
\usepackage{comment}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{bm}
\usepackage{mathtools}
\usepackage{enumitem}
\mathtoolsset{showonlyrefs}
\usepackage[dvipdfmx, colorlinks=true, linkcolor=blue, citecolor=blue, urlcolor=blue, setpagesize=false]{hyperref}
\usepackage{pxjahyper}
% --- 定理・定義環境 ---
\theoremstyle{definition}
\newtheorem{definition}{定義}[section]
\newtheorem{theorem}[definition]{定理}
\newtheorem{lemma}[definition]{補題}
\newtheorem{assumption}{仮定}
\newtheorem{proposition}[definition]{命題}
\newtheorem{requirement}[definition]{要請}
\newtheorem{example}[definition]{例}
\input{../command.tex}
% =========================================
\begin{document}

\title{$\fU, \gU$の条件を満たす解空間の特定}
\author{黒澤雅治}
\date{2025/12/21}
\maketitle
\tableofcontents
\clearpage

\section{\texorpdfstring{$\fU, \gU$}{fU, gU}の満たすべき条件}
\begin{enumerate}[label=\Alph*., ref=\Alph*]
  \item 要請\ref{req:1}を満たす。
    つまり、$f_iとg_j$は可換である。($L=6$のときはすべての$i,j$で可換)\label{condition:a}
  \item ある$i\neq j$について、$f_i$と$f_j$は可換でない。$g$についても同様。\label{condition:b}
  \item UTCBC$\uU(k)\text{ for }k\in\{0,1,2\}$以外に長さ$2L$以下の閉ブロックサイクルを含まない。\label{condition:c}
\end{enumerate}

\begin{requirement}\label{req:1}
  以下の可換性条件が成り立つことを要請する。
\begin{align}
  g_{\ell-j} \, f_{k-\ell} = f_{k-\ell} \, g_{\ell-j} \quad (\text{for all } \ell \in [L/2],\ j,k \in [J])
\end{align}
ここで、$f$ と $g$ のインデックスは $L/2$ を法として解釈される。
これは、以下の3つの記述のいずれとも等価である。
\begin{align}
& f_{\ell - j} \, g_{k - \ell} = g_{k - \ell} \, f_{\ell - j} \quad (\text{for all } \ell \in [L/2],\ j, k \in [J]),\\
& \text{すべての $\ell \in [L/2]$ および $j \in \{0,\pm 1,\ldots,\pm (J-1)\}$ に対して$f_\ell$ は $g_{- \ell + j}$ と可換である。}\\
 & \text{すべての $\ell \in [L/2]$ および $j \in \{0,\pm 1,\ldots,\pm (J-1)\}$ に対して$g_\ell$ は $f_{- \ell + j}$ と可換である。}
\end{align}
\end{requirement}

\section{可換性条件の分析}\label{ssec:analyzeCondA}
\begin{definition}
  関数$f$の係数を
  \begin{align}
    f = a_f x + b_f
  \end{align}で表す。($a_f,b_f\in[P],\quad \gcd(a_f, P) = 1$)
\end{definition}
可換性条件は、すべての$x\in[P]$に対して
\begin{align}
  &f(g(x)) = g(f(x))\\
  \iff &a_f(a_g x+b_g )+b_f = a_g (a_fx+b_f)+b_g \\
  \iff &a_fa_g x + a_fb_g  + b_f = a_g a_fx + a_g b_f + b_g \\
  \iff &a_fb_g  + b_f = a_g b_f + b_g \\
  \iff &(a_f-1)b_g  = (a_g -1)b_f\label{eq:original}
\end{align}
が成り立つことである。
式\eqref{eq:original}を、$b_g $に関する方程式とみなす。
この方程式は$\pmod{P}$上の1次合同方程式であることに注意する。
$A = a_f - 1$ および $C = (a_g - 1)b_f$ と定義する。このとき、加法成分 $b_g$ に関する1次合同方程式
\begin{align}
    A b_g \equiv C \pmod P
\end{align}
の解は以下の通りである。

\subsection*{ケース1：$a_f \neq 1$ かつ $a_g \neq 1$ の場合}
\begin{itemize}
    \item \textbf{$\gcd(A, P) = 1$ のとき} \\
    解は法 $P$ において一意に定まる。
    \begin{align}
        b_g \equiv A^{-1}C \pmod P
    \end{align}
    \item \textbf{$\gcd(A, P) = d > 1$ のとき}
    \begin{itemize}
        \item $C \not\equiv 0 \pmod d$ ならば、\textbf{解なし}。
        \item $C \equiv 0 \pmod d$ ならば、法 $P$ において以下の $d$ 個の解が存在する。
        \begin{align}
            b_g \equiv x_0 + n \frac{P}{d} \pmod P \quad (n = 0, 1, \dots, d-1)
        \end{align}
        ただし、$x_0$ は法 $P/d$ における合同方程式 $(A/d)x \equiv (C/d) \pmod{P/d}$ の一意な解である。
    \end{itemize}
\end{itemize}

\subsection*{ケース2：$a_f = 1$ かつ $a_g \neq 1$ の場合}
\begin{itemize}
    \item \textbf{$C \equiv 0 \pmod P$ のとき} \\
    任意の $b_g \in [P]$ が解となる（全解）。
    \item \textbf{$C \not\equiv 0 \pmod P$ のとき} \\
    \textbf{解なし}。
\end{itemize}

\subsection*{ケース3：$a_g = 1$ の場合（$C = 0$）}
\begin{itemize}
    \item \textbf{$a_f = 1$ のとき} \\
    任意の $b_g \in [P]$ が解となる。
    \item \textbf{$a_f \neq 1$ のとき}
    \begin{itemize}
        \item $\gcd(A, P) = 1$ ならば、\textbf{$b_g \equiv 0 \pmod P$} のみ。
        \item $\gcd(A, P) = d > 1$ ならば、以下の $d$ 個の解が存在する。
        \begin{align}
            b_g \equiv n \frac{P}{d} \pmod P \quad (n = 0, 1, \dots, d-1)
        \end{align}
    \end{itemize}
\end{itemize}
詳細な導出は付録\ref{app:proof2}を参照。

\section{サイクル}\label{ssec:cycle}
サイクルは、$L$列から偶数個の列を選び、開始行を指定することで一意に特定される。
以下、$L=6, J=2$に固定して考える。

\subsection{同一とみなせるサイクル}\label{ssec:samecycle}
\paragraph{シフト}\label{para:shift}
$\ell$のサイクルは、$\ell / 2$個の列から構成される。
よって、長さ$2L$以下のサイクルを考慮するには、$2,4,\dots,L$個の列からなるサイクルを考えればよい。
\begin{definition}
  列シーケンス$\ell$により構成され、開始位置が$j$行目であるサイクルを$\C{\ell}{j}$で表し、サイクルは行列における(0から始まる)インデックスの列として表現する。
\end{definition}

$\ell=[a,b,c,d]$について考える。
このとき、
\begin{align}
  \C{\ell}{0}=([0,a],[0,b],[1,b],[1,c],[0,c],[0,d],[1,d],[1,a])\\
  \C{\ell}{1}=([1,a],[1,b],[0,b],[0,c],[1,c],[1,d],[0,d],[0,a])
\end{align}

\begin{definition}
  1つの左シフトを$S(\cdot)$で表現し、$i$個左シフトする操作は$S^i(\cdot)$で表す。右シフトは$S^{-1}(\cdot)$で表す。
\end{definition}

1つシフトしたもの、2つシフトしたものについて考える(それ以上のシフトはこれらの組み合わせで再現できる。)
$\ell=[a,b,c,d]$を1つシフトした$S(\ell)=[b,c,d,a]$について、
\begin{align}
  \C{S(\ell)}{0}=([0,b],[0,c],[1,c],[1,d],[0,d],[0,a],[1,a],[1,b])=\C{\ell}{1}\\
  \C{S(\ell)}{1}=([1,b],[1,c],[0,c],[0,d],[1,d],[1,a],[0,a],[0,b])=\C{\ell}{0}
\end{align}

$\ell=[a,b,c,d]$を2つシフトした$S^2(\ell)=[c,d,a,b]$について、
\begin{align}
  \C{S^2(\ell)}{0}=([0,c],[0,d],[1,d],[1,a],[0,a],[0,b],[1,b],[1,c])=\C{\ell}{0}\\
  \C{S^2(\ell)}{1}=([1,c],[1,d],[0,d],[0,a],[1,a],[1,b],[0,b],[0,c])=\C{\ell}{1}
\end{align}

以上から、以下の定理が成り立つ。
\begin{theorem}\label{th:same_cycle}
  \begin{align}
    \C{(\ell)}{0} = \C{(S(\ell))}{1} = \C{S^2(\ell)}{0}\\
    \C{(\ell)}{1} = \C{(S(\ell))}{0} = \C{S^2(\ell)}{1}\\
  \end{align}
\end{theorem}
よって、ある列シーケンス$\ell$について、開始行が0,1行目である2つのサイクルを考えれば、列シーケンスをシフトしたものから構成されるサイクルすべてを網羅できる。

\subsection{同じ列の選択}\label{para:samecol}
同じ列を連続で含むときを考える。この列に含まれる2つの関数を$f,g$とする。
この時、サイクルの関数の中でこの列に関与する部分は、$f\inv gg\inv f=\text{id}$となる。
よって、この部分はサイクルが閉であるかには影響しないことが分かる。
これを利用することで、例えば$[1,2,3,3,4,5]$の列選択の検査と$[1,2,4,5]$の検査をまとめることができる。
ここで、$[1,2,3,3,2,5]$のような形の場合、同じ列を取り除いた結果、$[1,2,2,5]$のように同じ列の連続が生じることもあることに注意する。
また、今回サイクルを形成する列選択なので、$[1,2,3,4,3,1]$のように先頭と最後の要素が等しいときも、$[2,3,4,3]$と同一視することができる。

\section{UTCBC}
ここでサイクルの表記を定義する。
\begin{definition}
  行列$\HHX(\HHZ)$における、列選択$\ell$、開始行0(1)行目のサイクルを
  $\cy{X(Z)}{\ell}{0(1)}$で表す
\end{definition}
論文では、開始行が0行目であるとき、列選択
$\ell = [0,3+j\%3,1,3+(j-1)\%3,2,3+(j-2)\%3]$
からなるサイクルがUTCBCであることが示されている。
確認として、開始行が1行目の場合についても考える。
\begin{align}
  \cy{X}{\ell}{1} = 
  f_2
  \rightarrow g_{j-1}
  \rightarrow g_{j}
  \rightarrow f_1
  \rightarrow f_0
  \rightarrow g_{j+1}
  \rightarrow g_{j-1}
  \rightarrow f_2
  \rightarrow f_1
  \rightarrow g_j
  \rightarrow g_{j+1}
  \rightarrow f_0
  \rightarrow f_2
\end{align}
\begin{align}
  f_{\cy{X}{\ell}{1}}(x) &= 
  (
    f_0\inv
    g_{j+1}
    g_j\inv
    f_1
  )
  (
    f_2\inv
    g_{j-1}
    g_{j+1}\inv
    f_0
  )
  (
    f_2
    g_{j-1}\inv
    g_j
    f_1\inv
    )(x)\\
  &=
  (
    f_1
    g_j\inv
    g_{j+1}
    f_0\inv
  )
  (
    f_0
    g_{j+1}\inv
    g_{j-1}
    f_2\inv
  )
  (
    f_2
    g_{j-1}\inv
    g_j
    f_1\inv
  )(x)=x
\end{align}
よって、開始行に関わらず、この列選択から構成されるサイクルはUTCBCである。

\section{条件\ref{condition:c}で検査する列シーケンスの個数}
\ref{ssec:samecycle}節に基づき、検査する必要のある列シーケンスの個数を考える。
ここでは、隣り合う要素が異なり、かつ始点と終点が異なる（円環状に接続された）長さ$L$の列シーケンスを考える。使用できる列の総数を$k=6$とする。

\begin{theorem}\label{th:numberOfSequence}
  円環状に並べた際に隣り合うものが異なる列シーケンスの総数は、 
  \[
    (k-1)^L + (-1)^L(k-1)
  \]
  で表される。
  ただし、$L$は列シーケンスの長さ、$k$は列の選択肢の数。
\end{theorem}
証明は、付録\ref{app:proof1}を参照。
まず、$L=6$の場合を考える。
$k=6, L=6$を代入すると、
  \begin{align}
    5^6 + 5 = 15630
  \end{align}
  通りとなる。
\ref{para:shift}節を考慮し、シフトにより重なるものを同一視する。この際、周期的なパターン（$ababab$のような周期2の列や、$abcabc$のような周期3の列）は、シフトにより生成される同値類のサイズが小さくなるため、区別して数える必要がある。
\begin{itemize}
  \item 周期2の列（例：$ababab$）：$a,b$の選び方は$6 \times 5 = 30$通り。これらはシフトにより2つの列と同一視されるため、検査対象は$30/2 = 15$通り。
  \item 周期3の列（例：$abcabc$）：$a,b,c$が条件を満たす選び方は $5^3 - 5 = 120$通り。これらはシフトにより3つの列と同一視されるため、検査対象は$120/3 = 40$通り。
  \item 周期6の列（上記のいずれでもないもの）：総数から周期的な列を除くと $15630 - 30 - 120 = 15480$通り。これらはシフトにより6つの列と同一視されるため、検査対象は $15480/6 = 2580$通り。
\end{itemize}
以上より、検査すべき列シーケンスは $15 + 40 + 2580 = 2635$通りとなる。

次に、$L=4$の場合を考える。
同様に列シーケンス（始点指定あり）の総数は、
\begin{align}
  5^4 + 5 = 630
\end{align}
通りとなる。シフトによる同一視を考慮する。
\begin{itemize}
  \item 周期2の列（例：$abab$）：$6 \times 5 = 30$通り。シフトにより2つの列と同一視されるため、$30/2 = 15$通り。
  \item 周期4の列（周期2でないもの）：$630 - 30 = 600$通り。シフトにより4つの列と同一視されるため、$600/4 = 150$通り。
\end{itemize}
以上より、検査すべき列シーケンスは $15 + 150 = 165$通りとなる。

最後に、$L=2$の場合を考える。
列シーケンス（始点指定あり）の総数は、
\begin{align}
  5^2 + 5 = 30
\end{align}
通りとなる。
周期1の列（$aa$）は条件を満たさないため存在しない。すべての列が周期2（最小周期が長さと一致）であるため、単純に$L=2$で割ることができる。
検査すべき列シーケンスは $30/2 = 15$通りとなる。

以上より、検査する列シーケンスの総数は$2635+165+15=2815$通り。

\section{ブロックサイクルが閉かどうかの判定}\label{ssec:is_cbc}
サイクルの関数が$f(x)=ax+b$であるとする。
このとき、サイクルが閉であることはある$x\in[P]$について$ax+b = x$が成り立つことである。
よって、$(a-1)x+b=0$を満たす$x$が存在するならブロックサイクルは閉である。
この条件は、
\begin{align}
  b \equiv 0 \pmod{\gcd(a-1, P)}\label{eq:cbc}
\end{align}
と書き換えられる。つまり、$a=1$のとき、$b=0$ならばすべての$x$が解である。
$a\neq 1$のとき、$b$が$\gcd(a-1, P)$で割り切れる時のみ解が存在、すなわちサイクルは閉である。

\section{$\HHX$におけるチェックと$\HHZ$におけるチェックの等価性}
これは証明ができていない(そもそも等価かわからない)ので現時点では両方をチェック。
\begin{comment}
  \begin{align}
  \HHX
  &= \left(
    \begin{array}{ccc||ccc}
    f_0 & f_1 & f_2 & g_0 & g_1 & g_2 \\\hline
    f_2 & f_0 & f_1 & g_2 & g_0 & g_1
\end{array}
\right)
\end{align}
\begin{align}
\HHZ 
&= \left(
  \begin{array}{ccc||ccc}
  g_0\inv & g_{2}\inv & g_{1}\inv & f_0\inv & f_{2}\inv & f_{1}\inv \\\hline
  g_1\inv & g_0\inv & g_{2}\inv & f_1\inv & f_0\inv & f_{2}\inv
\end{array}
\right)
\end{align}
について、例として$\HHX$において開始行0、列シーケンス$\ell = [0,2,4,5]$から構成されるサイクルを考える。
\begin{align}
\cU = 
f_0
\rightarrow f_2
\rightarrow f_1
\rightarrow g_0
\rightarrow g_1
\rightarrow g_2
\rightarrow g_1
\rightarrow f_2
\rightarrow f_0
\end{align}
\begin{align}
f_{\cU}\inv(x) =
f_0\inv
f_2
f_1\inv
    g_0
    g_1\inv
    g_2
    g_1\inv
    f_2(x)
  \end{align}
  ここで、構成する関数が等しくなるような$\HHZ$における列シーケンスは$\ell' = [4,5,0,2]$である。
  この時$\HHZ$において列シーケンス$\ell'$から構成されるサイクルは、
  \begin{align}
  \cU'_0 = 
  f_2\inv
  \rightarrow f_1\inv
  \rightarrow f_2\inv
  \rightarrow g_1\inv
  \rightarrow g_0\inv
  \rightarrow g_1\inv
  \rightarrow g_2\inv
  \rightarrow f_0\inv
  \rightarrow f_2\inv
\end{align}
\begin{align}
f_{\cU'_0}\inv(x) =
f_2
f_1\inv
f_2
g_1\inv
g_0
g_1\inv
g_2
f_0\inv(x)
\end{align}
\begin{align}
\cU'_1 = 
f_0\inv
\rightarrow f_2\inv
\rightarrow f_1\inv
\rightarrow g_0\inv
  \rightarrow g_1\inv
  \rightarrow g_2\inv
  \rightarrow g_1\inv
  \rightarrow f_2\inv
  \rightarrow f_0\inv
\end{align}
\begin{align}
f_{\cU'_1}\inv(x) =
f_0
f_2\inv
f_1
g_0\inv
g_1
g_2\inv
g_1
f_2\inv(x)
\end{align}
\end{comment}

\section{行列を用いた条件\ref{condition:a},\ref{condition:b}を満たす解空間の特定}

条件\ref{condition:a},\ref{condition:b}を式に表すと以下である。
\begin{itemize}
  \item 条件\ref{condition:a}:
  \begin{align}
    (a_{f_i} - 1)b_{g_j} - (a_{g_j} - 1)b_{f_i} \equiv 0 \pmod P \quad\text{ for all }i,j\in[P]
  \end{align}
  \item 条件\ref{condition:b}:
  \begin{align}
    (a_{f_i} - 1)b_{f,j} - (a_{f,j} - 1)b_{f_i} \not\equiv 0 \pmod P \quad\text{ for any }i\neq j\in[P]\\
    (a_{g,i} - 1)b_{g_j} - (a_{g_j} - 1)b_{g,i} \not\equiv 0 \pmod P \quad\text{ for any }i\neq j\in[P]
  \end{align}
\end{itemize}

\begin{definition}
$\aU=[\aU_f, \aU_g]\tr=[a_{f_0},a_{f_1},a_{f_2},a_{g_0},a_{g_1},a_{g_2}]\tr,\bU=[\bU_f, \bU_g]\tr=[b_{f_0},b_{f_1},b_{f_2},b_{g_0},b_{g_1},b_{g_2}]\tr$とする。
\end{definition}

\begin{definition}
  行列を以下のように定義する。
  \begin{align}
  G_a &= \begin{bmatrix}
        1-a_{g_0} & 0 & 0 & a_{f_0}-1 & 0 & 0\\ %i=0,j=0
        1-a_{g_1} & 0 & 0 & 0 & a_{f_0}-1 & 0\\ %i=0,j=1
        1-a_{g_2} & 0 & 0 & 0 & 0 & a_{f_0}-1\\ %i=0,j=2
        0 & 1-a_{g_0} & 0 & a_{f_1}-1 & 0 & 0\\ %i=1,j=0
        0 & 1-a_{g_1} & 0 & 0 & a_{f_1}-1 & 0\\ %i=1,j=1
        0 & 1-a_{g_2} & 0 & 0 & 0 & a_{f_1}-1\\ %i=1,j=2
        0 & 0 & 1-a_{g_0} & a_{f_2}-1 & 0 & 0\\ %i=2,j=0
        0 & 0 & 1-a_{g_1} & 0 & a_{f_2}-1 & 0\\ %i=2,j=1
        0 & 0 & 1-a_{g_2} & 0 & 0 & a_{f_2}-1\\ %i=2,j=2
  \end{bmatrix}\\
  G_{b,f} &= \begin{bmatrix}
        1-a_{f_1} & a_{f_0}-1 & 0 & 0 & 0 & 0\\ %i=0,j=1
        1-a_{f_2} & 0 & a_{f_0}-1 & 0 & 0 & 0\\ %i=0,j=2
        0 & 1-a_{f_2} & a_{f_1}-1 & 0 & 0 & 0\\ %i=1,j=2
  \end{bmatrix}\\
  G_{b,g} &= \begin{bmatrix}
        0 & 0 & 0 & 1-a_{g_1} & a_{g_0}-1 & 0\\ %i=0,j=1
        0 & 0 & 0 & 1-a_{g_2} & 0 & a_{g_0}-1\\ %i=0,j=2
        0 & 0 & 0 & 0 & 1-a_{g_2} & a_{g_1}-1\\ %i=1,j=2
  \end{bmatrix}
\end{align}

\end{definition}

これを用いると、条件\ref{condition:a}は以下で表される。
\begin{align}\label{eq:cond_a_mat}
  G_a\bU \equiv O \pmod P
\end{align}
これを用いると、条件\ref{condition:b}は以下で表される。
\begin{align}
  G_{b,f} \bU \not\equiv \zeroU \pmod P\label{eq:cond_b_mat_f1}\\
  G_{b,g} \bU \not\equiv \zeroU \pmod P\label{eq:cond_b_mat_g1}
\end{align}

まずは、$\aU$を定数として固定した状態で条件a,bを満たす$\bU$の解空間を特定することを考える。
まずは簡単のため、$a_{f_i}\neq 0$、$a_{g,i}\neq 0$として考える。
式\eqref{eq:cond_a_mat}を解くと、基底$\vU_0,\dots,\vU_5$及係数$\cU=[c_0,\dots,c_5]\tr$により、解空間として
\begin{align}
  \bU = \sum_{j=0}^5 c_j \vU_j = V\cU
\end{align}
が求められる。ただし、$V=[\vU_0,\dots,\vU_5^\top],c_i\in[P]$である。

これにより、式\eqref{eq:cond_b_mat_f1}と\eqref{eq:cond_b_mat_g1}は
\begin{align}
  G_{b,f}V\cU &\not\equiv \zeroU\label{eq:cond_b_mat_f2}\\
  \iff M_f\cU &\not\equiv \zeroU\label{eq:cond_b_mat_f3}
  (M_f = G_{b,f}V)\\
  G_{b,g}V\cU &\not\equiv \zeroU\label{eq:cond_b_mat_g2}\\
  \iff M_g\cU &\not\equiv \zeroU\label{eq:cond_b_mat_g3}
  (M_g = G_{b,g}V)\\
\end{align}



% これを$\equiv \zeroU$として解くことで、条件\ref{condition:b}を満たさない係数$\cU$の空間が決定し、これを避けることで条件\ref{condition:a},\ref{condition:b}を満たす$\aU,\bU$が求まる。
% ここまでをP=384で実験したところ、ランダムに生成した $\aU$に対し、解となりうる$\cU$の数は 個。

\section{条件\ref{condition:c}の分析}
% 現状、確認すべき列選択が2815個あり、これを開始行0,1行目、行列$\HHX,\HHZ$について確認する必要があるので、総計で$2815\times4 = 11260$個のサイクルに関して方程式を立てる必要がある。
% これは、現実的ではない。一部のサイクルについて方程式を立て、これが解くことで、候補を絞ることができる。
\begin{definition}
  サイクル$\mathcal{C}$の関数$f_{\mathcal{C}}(x)$について、
  \begin{align}
    f_{\mathcal{C}}(x) = A_{\mathcal{C}}x+B_{\mathcal{C}}
  \end{align}
  と表すこととする。
\end{definition}

\ref{ssec:is_cbc}節より、このブロックサイクルが閉とならないための条件は
\begin{align}
  B_{\mathcal{C}} \not\equiv 0 \pmod{\gcd(A_{\mathcal{C}}-1, P)}
\end{align}
である。

\begin{definition}
  ここで、$B_{\mathcal{C}}$は$\bU$の線形結合なので、
  \begin{align}
    B_{\mathcal{C}} = V_{\mathcal{C}}\bU
  \end{align}
  と表すこととする。
\end{definition}

式\eqref{eq:cbc}に当てはめると、
\begin{align}
  B_{\mathcal{C}} &\not\equiv 0\\
  \iff V_{\mathcal{C}}\bU &\not\equiv 0\\
  \iff V_{\mathcal{C}}V\cU &\not\equiv 0 \pmod{\gcd(A_{\mathcal{C}}-1, P)}
\end{align}
現在、この式は$\bmod{gcd(A_{\mathcal{C}}-1, P)}$上の方程式であるが、これを$\bmod{P}$上の方程式に持ち上げる。
\begin{align}
  V_{\mathcal{C}}V\cU &\not\equiv 0 \pmod{\gcd(A_{\mathcal{C}}-1, P)}\\
  \iff \frac{P}{\gcd(A_{\mathcal{C}}-1, P)}V_{\mathcal{C}}V\cU &\not\equiv 0 \pmod{P}\\
  \iff V'_{\mathcal{C}}\cU &\not\equiv 0 \pmod{P}\left(V'_{\mathcal{C}} = \frac{P}{\gcd(A_{\mathcal{C}}-1, P)}V_{\mathcal{C}}\right)
  \label{eq:cond_c:mat}
\end{align}

\subsection{長さ4のサイクル}
例として、長さ4のサイクル$\mathcal{C}$に関する方程式を考える。
\begin{align}
  \mathcal{C} = f\rightarrow g\rightarrow h\rightarrow l\rightarrow f
\end{align}
とすると、
\begin{align}
  f_{\mathcal{C}}\inv(x) = 
  f\inv g h\inv l(x)
\end{align}
であり、
$f_i(x) = a_{f_i}x + b_{f_i}$および$f_i\inv(x) = a_{f_i}\inv(x - b_{f_i})$であるから、
 \begin{align}
    f_{\mathcal{C}}\inv(x) &= f\inv f h\inv l(x)\\
    &= a_f\inv(a_g a_h\inv(a_l x + b_l - b_h) + b_g - b_f)\\
    &= a_f\inv a_g a_h\inv a_l x + a_f\inv(b_g - b_f) + a_f\inv a_g a_h\inv (b_l - b_h)\\
\end{align}
とかける。

この表現を用いると、
\begin{align}
  \ABCfour{\mathcal{C}}{f}{g}{h}{l}\\
\end{align}
と書ける。

実際のサイクルで考えてみる。
\begin{example}
  まず、
  \begin{align}
    \HHX
    &= \left(
      \begin{array}{ccc||ccc}
      f_0 & f_1 & f_2 & g_0 & g_1 & g_2 \\\hline
      f_2 & f_0 & f_1 & g_2 & g_0 & g_1
  \end{array}
  \right)
  \end{align}
  \begin{align}
  \HHZ 
  &= \left(
    \begin{array}{ccc||ccc}
    g_0\inv & g_{2}\inv & g_{1}\inv & f_0\inv & f_{2}\inv & f_{1}\inv \\\hline
    g_1\inv & g_0\inv & g_{2}\inv & f_1\inv & f_0\inv & f_{2}\inv
  \end{array}
  \right)
  \end{align}
  である。
  列選択[0,1]について
  \begin{align}
    \cy{X}{[0,1]}{0}=f_0\rightarrow f_1\rightarrow f_0\rightarrow f_2\rightarrow f_0
  \end{align}
  なので、
  \begin{align}
    \ABCfour{\cy{X}{[0,1]}{0}}{f_0}{f_1}{f_0}{f_2}\\
  \end{align}
  \begin{align}
  B_{\cy{X}{[0,1]}{0}} &= 
  \begin{bmatrix}
    -a_{f_0}\inv(1+a_{f_1}a_{f_0}\inv) & a_{f_0}\inv & - a_{f_0}\inv a_{f_1}a_{f_0}\inv & 0 & 0 & 0
  \end{bmatrix}
  \bU
\end{align}
であるから、
\begin{align}
    V_{\cy{X}{[0,1]}{0}} =
    \begin{bmatrix}
      -a_{f_0}\inv(1+a_{f_1}a_{f_0}\inv) & a_{f_0}\inv & - a_{f_0}\inv a_{f_1}a_{f_0}\inv & 0 & 0 & 0
  \end{bmatrix}
\end{align}
である。
\end{example}
        
条件\ref{condition:c}では、確認すべき列選択が2815個あり、これを開始行0,1行目、行列$\HHX,\HHZ$について確認する必要があるので、総計で$2815\times4 = 11260$個のサイクルに関して方程式を立てる必要がある。

以上まとめると、\eqref{eq:cond_a_mat}を解いて求めた基底$\vU_0,\dots$について、\eqref{eq:cond_b_mat_f3}と\eqref{eq:cond_b_mat_g3}および、11260個のサイクルに対応する\eqref{eq:cond_c:mat}の計11262個の合同不等式を満たすような係数$c_0,\dots$を求めればよいことが分かった。

\section{2026/01/16のゼミ}
\subsection{ここまでの進捗}
\begin{itemize}
  \item $\aU$を固定したときの条件\ref{condition:a},\ref{condition:b}を満たす$\bU$を見つけるための方法を考えた。
  \item 条件\ref{condition:c}について、すべてのサイクルを網羅でする方法を明確にした。
  \item 最終的に解となる$\aU,\bU$が満たすべき数式を出した。
\end{itemize}

\subsection{これからのタスク}
\begin{itemize}
  \item 11262個の不等式をそれぞれ解くことで$\equiv 0$になってしまう$c_i$は出し、これらを除外して残ったものを解とする、というのは現実的ではない？
  \item サイクル同士で依存関係(サイクル$\calC_1$がCBCならサイクル$\calC_2$もCBC)が見つけられれば式の数を削減できる。
  \item $\bU$に関する条件式ならば一次だが、$\aU$に関する条件式とみなすと次数が上がるので$\aU,\bU$すべてを変数とみなすときにこの方式を使うのは難しそう。
\end{itemize}

\section{笠井先生の論文Breaking the Orthogonality Barrier in Quantum LDPC Codesについて}
\subsection{従来の行列の構成方法}
\begin{definition}\label{def:01231}
  $\HHX,\HHZ$を母行列、$\HX,\HZ$をアクティブ行列、$\tHX,\tHZ$を潜在部と呼ぶ。
  以下が成り立つ。
  \begin{align}\label{eq:01232}
  \HHX = \begin{bmatrix}
  \HX\\
  \tHX
  \end{bmatrix},\qquad
  \HHZ = \begin{bmatrix}
  \HZ\\
  \tHZ
  \end{bmatrix}
  \end{align}
\end{definition}
$\HHX,\HHZ$は2つの直交する正方(ブロック巡回)母行列である。
これらにより構成される母行列のレートは0である。
よってレートを調整するのに内部行を消去する。

ここで、母行列の直交性は潜在部の行に強い制約を課し、最小距離を劣化させる。
\begin{definition}\label{def:01233}
最小距離を以下で定義する。
\begin{align}\label{eq:01234}
  \dz := \min\{\wt(z):z\in C_X\backslash C_Z^\top\},\qquad
  \dx := \min\{\wt(x):x\in C_Z\backslash C_X^\top\}
\end{align}  
\end{definition}
\begin{theorem}\label{th:01235}
  母行列の直交性$\HHX(\HHZ)^\top=0$は、アクティブ部の直交性$\HX(\HZ)^\top=0$だけでなく、
  \begin{align}\label{eq:01236}
    \HX(\tHZ)^\top=0,\qquad
    \tHX(\HZ)^\top=0
  \end{align}
  も強要する。  
\end{theorem}
これは、$\Row(\HHX)\subset C_Z$および$\Row(\HHZ)\subset C_X$であることを暗示している。
したがって、$\tHX$の各行$\bm{x}$について$\bm{x}\in C_Z$、$\tHZ$の各行$\bm{z}$について$\bm{z}\in C_X$が成り立つ。
一般的には$\bm{x}$は$C_X^\top$に属する必要はなく、$\bm{z}$も$C_Z^\perp$に属する必要はなく、このときこれらは論理演算子となる。最小行重み(我々の構成では$L$)が$d_X$および$d_Z$の上界となる。

\subsection{新しい行列の構成方法}
母行列から行を削除することでアクティブ行列$\HX,\HZ$を得るが、潜在行列の低重み行が、$\HX,\HZ$と直交しないようにこれらを設計する。
つまり、低重みの$\bm{x}\in\Row(\tHX)$に対し$\HZ\bm{x}^\top \neq 0$を、$\bm{z}\in\Row(\tHZ)$に対し$\HX\bm{z}^\top \neq 0$を強制し、つまり$\Row(\tHX)\not\subset C_Z$および$\Row(\tHZ)\not\subset C_X$を強制する。
同じ議論は、個々の潜在行だけでなく、低重みの線形結合にも適用される。

\begin{definition}\label{def:01237}
  潜在ベースの$X,Z$距離の上界を以下で定義する。
  \begin{align}
  d_X^{\text{(lat)}} &:= \min\left\{\wt(\bm{x}):\bm{x}\in \Row(\tHX)\cap C_Z\backslash C_X^\perp\right\}\\
  &=\min\left\{\wt(\bm{x}):\bm{x}\in C_Z, \bm{x}=(\tHX)^\top\bm{u}\text{ for some }\bm{u}, \bm{x}\not\in C_X^\top\right\}\\
  d_Z^{\text{(lat)}} &:= \min\left\{\wt(\bm{z}):\bm{z}\in \Row(\tHZ)\cap C_X\backslash C_Z^\perp\right\} \\
  &=\min\left\{\wt(\bm{z}):\bm{z}\in C_X, \bm{z}=(\tHZ)^\top\bm{u}\text{ for some }\bm{u}, \bm{z}\not\in C_Z^\top\right\}\\
\end{align}
\end{definition}

まとめると、
\begin{align}
\HX\HZ^\top = 0,\quad\HX(\tHZ)^\top \neq 0, \quad\HZ(\tHX)^\top \neq 0 
\end{align}
かつ$\dxl,\dzl$が大きい、を満たすような潜在行列$\tHX,\tHZ$を構成したい。
一般化した萩原・今井符号、つまりブロック巡回構造の母行列のペアを定義し、アクティブ部の直交性$\HX(\HZ)^\top = 0$のみを課す。
行重み$J$、列重み$L$のプロトグラフLDPC符号はサイズ$P$の$J\times L$の置換行列により定義される。

\begin{definition}\label{def:01238}
  サイズ$LP/2\times LP$の母行列を以下で定義する。
  \begin{align}
    (\HHX)_{i,j} &= F_{j-i},\quad (\HHX)_{i,L_2+j}=G_{j-i},\\
    (\HHZ)_{i,j} &= G_{i-j}^\top,\quad (\HHZ)_{i,L_2+j}=F_{i-j}^\top,
  \end{align}
\end{definition}
アクティブ行列は母行列の上$J$ブロック行を取ることで得られる。

潜在部がアクティブ部と可換でないようにすることで、低重みの潜在部の組は自動的に論理演算子にならない。

ブロック巡回構造は$\HX(\HZ)^\top$が差分のみに依存するようにし、結果である
Interaction Matrix$\Psi_r$により、可換性制約を小さな差分集合に位置づけられる。


$\HHX$の各ブロック行は、左側は$(F_0,F_1,\dots,F_{L/2-1})$の巡回シフトであり、右側は$(G_0,G_1,\dots,G_{L/2-1})$の巡回シフトである。
したがってブロックは差分$(j-i)$のみに依存し、母行列の積も差分のみに依存する。
任意の$i,k\in[L/2]$に対して、$(i,k)$ブロックは
\begin{align}
  (\HHX(\HHZ)^\top)_{i,k} = \sum_{u=0}^{L_2-1}\left(F_uG_{k-u} + G_{k-u}F_u\right) =: \Psi_r
\end{align}
で与えられ、これは$r=(k-i)\mod L_2$のみに依存する。
$r\in[L/2]$に対し、すべての$u\in[L/2]$に対し$F_u$と$G_{r-u}$が可換ならば、$\Psi_r=0$である。

\subsection{アクティブ部の直交性の十分条件}
\begin{definition}\label{def:01239}
  \begin{align}
    \Delta := \left\{(k-i)\mod L/2\mid 0\leq i,k\leq J-1\right\}\subseteq[L/2]
  \end{align}
\end{definition}
\begin{theorem}\label{th:012310}
  もし$F_u$と$G_{r-u}$がすべての$r\in\Delta,u\in[L/2]$に対し可換ならば、$\HX\HZ^\top=0$である。
\end{theorem}

\subsection{潜在部の非直交性の必要条件}
\begin{definition}\label{def:012311}
  可換性が必要な$(F_i,G_j)$のインデックスペアを以下で定義する。
  \begin{align}
    \Gamma := \bigcup_{r\in\Delta} \Gamma_r,\quad \Gamma_r := \{(i,j)\mid(i,j)=(u,r-u), u\in[L/2]\}
  \end{align}
\end{definition}
$L\geq 4J$および$\Psi_r\neq 0$を満たすような$r\in[L/2]\backslash \Delta$が存在することが、
潜在部の非直交性の必要条件である。

\subsection{ガーズの上界}
長さ8のサイクルは必ず存在する。

\subsection{行列構築の方法}
与えられた$(L/2,P,J)$に対して、以下を同時に満たす$\{F_i\},\{G_i\}$を構築する。
\begin{enumerate}
  \item $f_i,G_j$は$(i,j)\in\Delta$に対して可換である\label{condition:a'}
  \item 少なくとも一つの$(i,j)\in[L/2]^2\backslash\Delta$に対して非可換である\label{condition:b'}
  \item アクティブ行列$\HX,\HZ$内の短いサイクルを避ける(長さ8以下のUTCBC以外のサイクル)\label{condition:c'}
\end{enumerate}
可換表テーブル：
\begin{table}[h]
\centering
\begin{tabular}{c|cccccc}
      & $G_0$ & $G_1$ & $G_2$ & $G_3$ & $G_4$ & $G_5$ \\ \hline
$F_0$ & 1     & 1     & 1     & 0     & 1     & 1     \\
$F_1$ & 1     & 1     & 0     & 1     & 1     & 1     \\
$F_2$ & 1     & 1     & 1     & 1     & 1     & 1     \\
$F_3$ & 1     & 1     & 1     & 1     & 1     & 1     \\
$F_4$ & 1     & 1     & 1     & 1     & 1     & 1     \\
$F_5$ & 1     & 1     & 1     & 1     & 1     & 1     \\
\end{tabular}
\end{table}

\section{この論文での条件を満たす$F_i,G_i$の構成}
目標は、$f_0$と$g_3$、$f_1$と$g_2$が非可換であり、他がすべて可換であるような$F_i,G_i$を見つけることである。(他が厳密に可換である必要があるのかはわからないが、今は条件から解空間を特定することに集中する。)

これまでと同様、$f_i(x) = a_{f_i}x+b_{f_i}$のようにあらわす。
\subsection{条件A'}
\begin{align}
  (a_{f_i} - 1)b_{g_j} - (a_{g_j} - 1)b_{f_i} \not\equiv 0 \pmod P\quad\text{ for }(i,j)\in[L/2]^2\backslash\{(0,3),(1,2)\}\label{eq:01231}
\end{align}

\subsection{条件B'}
\begin{align}
  (a_{f_i} - 1)b_{g_j} - (a_{g_j} - 1)b_{f_i} \not\equiv 0 \pmod P\quad\text{ for }(i,j)=(0,3),(1,2)\label{eq:012312}
\end{align}


\subsection{条件C'}
条件\ref{condition:c'}を考える前に、今回の$\HHX,\HHZ$におけるUTCBCを特定する。
$\HHX,\HHZ$は以下である。
\begin{align}
  \HHX &= \left( \begin{array}{cccccc|cccccc}
  F_0 & F_1 & F_2 & F_3 & F_4 & F_5 & G_0 & G_1 & G_2 & G_3 & G_4 & G_5 \\
  F_5 & F_0 & F_1 & F_2 & F_3 & F_4 & G_5 & G_0 & G_1 & G_2 & G_3 & G_4 \\
  F_4 & F_5 & F_0 & F_1 & F_2 & F_3 & G_4 & G_5 & G_0 & G_1 & G_2 & G_3 \\ \hline
  F_3 & F_4 & F_5 & F_0 & F_1 & F_2 & G_3 & G_4 & G_5 & G_0 & G_1 & G_2 \\
  F_2 & F_3 & F_4 & F_5 & F_0 & F_1 & G_2 & G_3 & G_4 & G_5 & G_0 & G_1 \\
  F_1 & F_2 & F_3 & F_4 & F_5 & F_0 & G_1 & G_2 & G_3 & G_4 & G_5 & G_0
  \end{array} \right).\\
  \HHZ &= \left( \begin{array}{cccccc|cccccc}
  G'_0 & G'_5 & G'_4 & G'_3 & G'_2 & G'_1 & F'_0 & F'_5 & F'_4 & F'_3 & F'_2 & F'_1 \\
  G'_1 & G'_0 & G'_5 & G'_4 & G'_3 & G'_2 & F'_1 & F'_0 & F'_5 & F'_4 & F'_3 & F'_2 \\
  G'_2 & G'_1 & G'_0 & G'_5 & G'_4 & G'_3 & F'_2 & F'_1 & F'_0 & F'_5 & F'_4 & F'_3 \\ \hline
  G'_3 & G'_2 & G'_1 & G'_0 & G'_5 & G'_4 & F'_3 & F'_2 & F'_1 & F'_0 & F'_5 & F'_4 \\
  G'_4 & G'_3 & G'_2 & G'_1 & G'_0 & G'_5 & F'_4 & F'_3 & F'_2 & F'_1 & F'_0 & F'_5 \\
  G'_5 & G'_4 & G'_3 & G'_2 & G'_1 & G'_0 & F'_5 & F'_4 & F'_3 & F'_2 & F'_1 & F'_0
  \end{array} \right).
\end{align}

論文の通り、
\begin{align}
    W=F_{i}G_j\inv G_{j'}F_i\inv F_{i'}G_{j'}\inv G_jF_{i'}\inv\label{eq:01232}
\end{align}
はUTCBCである。
他にもUTCBCの形があるかもしれない。
\begin{definition}
  行インデックスシーケンス$c$、列インデックスシーケンス$r$により特定される$\HHX(\HHZ)$でのサイクルを$\cy{c}{r}{X(Z)}$と表す。
\end{definition}

\subsubsection{長さ4のサイクル}
長さ4のサイクルは、長さ2の行インデックスシーケンス及び長さ2の列インデックスシーケンスを与えれば、一意に特定される。
例えば、
\begin{align}
  \cy{[0,7]}{[0,1]}{X}&=
  (\HHX)_{0,0}\rightarrow
  (\HHX)_{0,7}\rightarrow
  (\HHX)_{1,7}\rightarrow
  (\HHX)_{1,0}\\
  &=F_0\rightarrow
  G_1\rightarrow
  G_0\rightarrow
  F_5
\end{align}となる。

行インデックスシーケンス$c=[c_1,c_2]$、列インデックスシーケンス$r=[r_1,r_2]$とする。ただし、$c_1,c_2\in[L]$、$r_1,r_2\in[L/2]$である。
\paragraph{同一とみなせるサイクル}
$c_1=c_2$または$r_1=r_2$のとき、このサイクルの関数は明らかに恒等関数となる。
$\cy{[c_1, c_2]}{[r_1, r_2]}{X}$が閉ならば、$\cy{[c_1, c_2]}{[r_2, r_1]}{X},\cy{[c_2, c_1]}{[r_1, r_2]}{X},\cy{[c_2, c_1]}{[r_2, r_1]}{X}$も閉である。

以上を踏まえると、$c_1<c_2, r_1<r_2$としてよく、列インデックスシーケンスは$(L^2-L)/2$通り、列インデックスシーケンスは$((L/2)^2-L/2)/2$通りあり、これらを$\HHX,\HHZ$で考えるので、長さ4のサイクルは$(L^2-L)/2\times ((L/2)^2-L/2)/2\times2$通りある。
$L=12$で考えると、$12^4/2 = 10368$通りとなる。

\subsubsection{長さ8のサイクル}
長さ8のサイクルは、長さ4の行インデックスシーケンス及び長さ4の列インデックスシーケンスを与えれば、一意に特定される。
例えば、
\begin{align}
  \cy{[0,7,1,5]}{[0,1,2,3]}{X}&=
  (\HHX)_{0,0}\rightarrow
  (\HHX)_{0,7}\rightarrow
  (\HHX)_{1,7}\rightarrow
  (\HHX)_{1,1}\\
  &\rightarrow
  (\HHX)_{2,1}\rightarrow
  (\HHX)_{2,5}\rightarrow
  (\HHX)_{3,5}\rightarrow
  (\HHX)_{3,0}\\
  &=F_0\rightarrow
  G_1\rightarrow
  G_0\rightarrow
  F_0\rightarrow
  F_5\rightarrow
  F_3\rightarrow
  F_2\rightarrow
  F_3
\end{align}となる。
行インデックスシーケンスは$(L/2)^4$通り、列インデックスシーケンスは$L^4$通りあり、これらを$\HHX,\HHZ$で考えるので、長さ4のサイクルは$(L/2)^4\times L^4\times 2=L^8/8$通りある。
$L=12$で考えると、$12^8/8 = 53747712$通りとなる。





\input{appendix.tex}
\end{document}